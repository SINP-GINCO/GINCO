{% extends "IgnConfigurateurBundle::layout.html.twig" %} {% form_theme
modelForm 'bootstrap_3_horizontal_layout.html.twig' %} {% block title
%}{% trans %}Model Edition {%endtrans%}{% endblock %} {% block body %}


<div class="container">

	<p class="help pull-right">
		<a target="_blank" href="{{ constant('Ign\\Bundle\\ConfigurateurBundle\\Constants\\Constants::DOCUMENTATION_URL') }}/configurateur/modele-de-donnees.html">
			<span class="glyphicon glyphicon-question-sign" aria-hidden="true"></span>
			Aide sur les modèles de données
		</a>
	</p>

	<div class="row">
		<ol class="breadcrumb">
			<li><a href="{{ path('configurateur_homepage') }}">{%trans %}breadcrumb.home{% endtrans %}</a></li>
			<li><a href="{{ path('configurateur_model_index') }}">{%trans %}breadcrumb.datamodel.index{% endtrans %}</a></li>
			<li class="active">{% trans with {'%modelName%': modelName}%}breadcrumb.datamodel.edit{% endtrans %}</li>
		</ol>
	</div>

	<div class="row">
		{# Flash messages #}
		{% for flashMessage in app.session.flashbag.get('notice') %}
			<div class="alert alert-success">
				{{ flashMessage }}
			</div>
		{% endfor %}
		{% for flashMessage in app.session.flashbag.get('error') %}
			<div class="alert alert-danger">
				{{ flashMessage }}
			</div>
		{% endfor %}
		{% for flashMessage in app.session.flashbag.get('warning') %}
			<div class="alert alert-warning">
				{{ flashMessage }}
			</div>
		{% endfor %}

		<div class="panel panel-primary">
			<div class="panel-heading">
				<h3 id="panel-title" class="panel-title">
					{% trans with {'%name%': modelName}%}datamodel.edit.title{% endtrans %}
				</h3>
			</div>
			<div class="panel-body">{{ form(modelForm) }}</div>
		</div>
	</div>

	<div class="row">
		<div class="panel panel-primary">
			<div class="panel-heading">
				<h3 id="panel-title" class="panel-title">
					{% trans %}datamodel.edit.tables.list{% endtrans %}
				</h3>
			</div>
			<div class="panel-body">
				{% if tables|length != 0 %}
				<div class=col-md-6>
					<table class="table table-bordered table-striped">
						<thead>
							<tr>
								<th data-halign="center" data-align="center">{% trans %}datamodel.edit.tables.title{% endtrans %}</th>
								<th data-align="center">{% trans %}Edit{% endtrans %}</th>
								<th data-align="center">{% trans %}Fields{% endtrans %}</th>
							</tr>
						</thead>
						{% for table in tables %}
						<tr>
							<td>{{ table.label }}</td>

							<td class=col-md-1><a type="button" class="btn btn-default"
								title="Editer la table"
								href="{{ path('configurateur_table_edit',{ 'modelId' : model.id, 'format': table.format} ) }}">
									<span class="glyphicon glyphicon-pencil" aria-hidden="true"></span>
							</a></td>
							<td class=col-md-1><a type="button" class="btn btn-default"
								  title="Gérer les champs"
								  href="{{ path('configurateur_table_fields',{ 'modelId' : model.id, 'format': table.format} ) }}">
									<span class="glyphicon glyphicon-th-list" aria-hidden="true"></span>
							</a></td>
						</tr>
						{% endfor %}
					</table>
				</div>
				{% endif %}
			</div>
		</div>
	</div>

	<div class="row">
		{# Publish button #}
		{# If the model is publishable (not empty) #}
		{% if publishable %}
			<a role="button" class="btn btn-default"
				  href="{{ path('configurateur_model_publish', { modelId: model.id } ) }}"> <span
						class="glyphicon glyphicon-play" aria-hidden="true"></span>
				{%trans %}Publish{% endtrans %}
			</a>
		{# Not publishable : disable button and add an explanation modal #}
		{% else %}
			<button class="btn btn-default" disabled="disabled">
				<span class="glyphicon glyphicon-play" aria-hidden="true"></span>
				{%trans %}Publish{% endtrans %}
			</button>
			<button class="btn btn-default" data-toggle="modal" data-target="#modal-info-not-publishable">
				<span class="glyphicon glyphicon-question-sign" aria-hidden="true"></span>
			</button>

			<!-- Info modal - model not publishable -->
			<div class="modal fade" id="modal-info-not-publishable"
				 tabindex="-1" role="dialog" aria-labelledby="myModalLabel"
				 aria-hidden="true">
				<div class="modal-dialog">
					<div class="modal-content">
						<div class="modal-body">
							{% trans with {'%modelName%': model.name} %} datamodel.publish.impossible {% endtrans %}
						</div>
						<div class="modal-footer">
							<button type="button" class="btn btn-primary"
									data-dismiss="modal">{% trans %}ok{% endtrans %}</button>
						</div>
					</div>
				</div>
			</div>
		{% endif %}
	</div>
</div>

{% endblock %}

{% block javascripts %}
	{{ parent() }}
	{{ include('IgnConfigurateurBundle::preventclosing.html.twig') }}
{% endblock %}

{% block specificjavascripts %} {% endblock %}