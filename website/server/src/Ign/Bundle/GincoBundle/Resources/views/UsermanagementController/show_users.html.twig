{% extends "::base.html.twig" %}

{% block body %}

<h1>{% trans %}Users{% endtrans %}</h1>

{% if users|length > 0 %}

	<table	id="users-table" data-toggle="table"
			data-click-to-select="true" data-search="true" data-search-align="right"
			data-maintain-selected = "true" data-classes="table table-hover table-condensed"
			data-locale="fr-FR" data-pagination="true" data-advanced-search="true" data-id-table="advancedTable">
		<thead>
			<tr>
				<th data-field="login" data-sortable="true">{% trans %}User Login{% endtrans %}</th>
				<th data-field="username" data-sortable="true">{% trans %}User Name{% endtrans %}</th>
				<th data-field="label" data-sortable="true">{% trans %}Provider{% endtrans %}</th>
				<th data-field="email" data-sortable="true">{% trans %}Email{% endtrans %}</th>
				<th data-field="roles" data-sortable="true">{% trans %}Roles{% endtrans %}</th>
				<th data-searchable="false">{% trans %}Actions{% endtrans %}</th>
			</tr>
		</thead>

		<tbody>
			{% for user in users %}
			<tr>
				<td>{{ user.login }}</td>
				<td>{{ user.username }}</td>
				<td>{{ user.provider.label }}</td>
				<td>{{ user.email }}</td>
				<td>
					{% for role in user.roles %}
						{{ role.label }}<br/>
					{% endfor %}
				</td>
				<td>
				{% if isDeletableUser[user.login] %}
					<a role="button" class="btn btn-sm btn-success" title="{{ 'Edit'|trans }}" href="{{ path('usermanagement_editUser', {'login' : user.login}) }}">
						<span class="glyphicon glyphicon-pencil" aria-hidden="true"></span>
					</a>
					<a role="button" class="btn btn-sm btn-warning"  title="{{ 'Change Password'|trans }}" href="{{ path('usermanagement_changePassword', {'login' : user.login}) }}">
						<span class="glyphicon glyphicon-lock" aria-hidden="true"></span>
					</a>
					<button class="btn btn-sm btn-danger" title="{{ 'Delete'|trans }}" data-toggle="modal" data-target="#modal-delete-user-{{ user.login }}">
						<span class="glyphicon glyphicon-remove" aria-hidden="true"></span>
					</button>

					<!-- Modal - Delete user -->
					<div class="modal fade" id="modal-delete-user-{{ user.login }}"
						 tabindex="-1" role="dialog" aria-labelledby="myModalLabel"
						 aria-hidden="true">
						<div class="modal-dialog">
							<div class="modal-content">
								<div class="modal-body">
									{% trans with {'%userLogin%': user.login} %} Users.delete.prompt {% endtrans %}
								</div>
								<div class="modal-footer">
									<button type="button" class="btn btn-default"
											data-dismiss="modal">{% trans %}Cancel{% endtrans %}</button>
									<a type="button" class="btn btn-primary"
									   href="{{ path('usermanagement_deleteUser', {'login' : user.login}) }}">
										{% trans %}Continue{% endtrans %} </a>
								</div>
							</div>
						</div>
					</div>
				{% else %}
						<button class="btn btn-sm btn-default btn-disabled" title="{{ 'Edit'|trans }}" data-toggle="modal" data-target="#modal-impossible-edit-user-{{ user.login }}">
							<span class="glyphicon glyphicon-pencil" aria-hidden="true"></span>
						</button>

						<!-- Modal - Edit user Impossible -->
						<div class="modal fade" id="modal-impossible-edit-user-{{ user.login }}"
							 tabindex="-1" role="dialog" aria-labelledby="myModalLabel"
							 aria-hidden="true">
							<div class="modal-dialog">
								<div class="modal-content">
									<div class="modal-body">
										{% trans with {'%username%': user.username} %} User.edit.impossible {% endtrans %}
									</div>
									<div class="modal-footer">
										<button type="button" class="btn btn-default"
												data-dismiss="modal">{% trans %}Cancel{% endtrans %}</button>
									</div>
								</div>
							</div>
						</div>

						<button class="btn btn-sm btn-default btn-disabled" title="{{ 'Change Password'|trans }}" data-toggle="modal" data-target="#modal-impossible-change-password-user-{{ user.login }}">
							<span class="glyphicon glyphicon-lock" aria-hidden="true"></span>
						</button>

						<!-- Modal - Change password user Impossible -->
						<div class="modal fade" id="modal-impossible-change-password-user-{{ user.login }}"
							 tabindex="-1" role="dialog" aria-labelledby="myModalLabel"
							 aria-hidden="true">
							<div class="modal-dialog">
								<div class="modal-content">
									<div class="modal-body">
										{% trans with {'%username%': user.username} %} User.change_password.impossible {% endtrans %}
									</div>
									<div class="modal-footer">
										<button type="button" class="btn btn-default"
												data-dismiss="modal">{% trans %}Cancel{% endtrans %}</button>
									</div>
								</div>
							</div>
						</div>

						<button class="btn btn-sm btn-default btn-disabled" title="{{ 'Delete'|trans }}" data-toggle="modal" data-target="#modal-impossible-delete-user-{{ user.login }}">
							<span class="glyphicon glyphicon-remove" aria-hidden="true"></span>
						</button>

						<!-- Modal - Delete user Impossible -->
						<div class="modal fade" id="modal-impossible-delete-user-{{ user.login }}"
							 tabindex="-1" role="dialog" aria-labelledby="myModalLabel"
							 aria-hidden="true">
							<div class="modal-dialog">
								<div class="modal-content">
									<div class="modal-body">
										{% trans with {'%username%': user.username} %} User.delete.impossible {% endtrans %}
									</div>
									<div class="modal-footer">
										<button type="button" class="btn btn-default"
												data-dismiss="modal">{% trans %}Cancel{% endtrans %}</button>
									</div>
								</div>
							</div>
						</div>
					{% endif %}
				</td>
			</tr>
			{% endfor %}
		</tbody>
	</table>
{% else %}
	<p>{% trans %}Users.no_users{% endtrans %}</p>
{% endif %}

<p>
    <a href="{{ path('usermanagement_editUser') }}"><span class="glyphicon glyphicon-plus" aria-hidden="true"></span> {% trans %}Create User{% endtrans %}</a>
<p/>
{% endblock %}
